<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>Add new task</ion-title>
    <ion-icon name="close" slot="end" size="larger" class="ion-padding" (click)="dismiss()"></ion-icon>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-card class="ion-align-self-center">
    
    <!-- Task Name -->
    <ion-item>
      <ion-textarea [(ngModel)]="taskName" placeholder="Write task here" required></ion-textarea>
    </ion-item>
    <!-- Show error message only after submit attempt -->
    <ion-text color="danger" *ngIf="isSubmitted && taskName.trim() === ''">Task name is required</ion-text>
    
    <!-- Task Priority -->
    <ion-item>
      <ion-icon name="star" slot="start"></ion-icon>
      <ion-label>Priority</ion-label>
      <span>
        <ion-select [(ngModel)]="taskPriority" required>
          <ion-select-option value="low">Low</ion-select-option>
          <ion-select-option value="middle">Middle</ion-select-option>
          <ion-select-option value="high" selected>High</ion-select-option>
        </ion-select>
      </span>
    </ion-item>

    <!-- Due Date -->
    <ion-item button="true" (click)="toggleDatepicker()">
      <ion-icon name="calendar-outline" slot="start"></ion-icon>
      <ion-label>Due Date</ion-label>
      <span>{{ displayTaskDueDate || 'Select a date' }}</span>
    </ion-item>
    <!-- Show error message only after submit attempt -->
    <ion-text color="danger" *ngIf="isSubmitted && taskDueDate === ''">Due date is required</ion-text>

    <!-- Show calendar only when datepicker is toggled -->
    <ion-item *ngIf="showDatepicker">
      <ion-datetime 
        [(ngModel)]="taskDueDate" 
        presentation="date" 
        displayFormat="D MMM YYYY" 
        (ionChange)="formatTaskDueDate()">
      </ion-datetime>
    </ion-item>

    <!-- Task Category -->
    <ion-item>
      <ion-icon name="pricetag-outline" slot="start"></ion-icon>
      <ion-label>Category</ion-label>
      <span>{{ selectedCategory || 'None' }}</span>
    </ion-item>
    <!-- Show error message only after submit attempt -->
    <ion-text color="danger" *ngIf="isSubmitted && selectedCategory === ''">Category is required</ion-text>

    <!-- Category Chips -->
    <ion-item>
      <ion-chip *ngFor="let category of categories; let i = index" color="secondary" outline="true" (click)="selectCategory(i)">
        <ion-label color="secondary">{{ category }}</ion-label>
      </ion-chip>
    </ion-item>

    <!-- Add Task Button -->
    <ion-button class="ion-margin" expand="block" (click)="addTask()">Add Task</ion-button>

  </ion-card>
</ion-content>
